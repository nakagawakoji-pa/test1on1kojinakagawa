# 1on1 発話比率測定アプリ - 仕様書

## 概要

このアプリケーションは、上司と部下の1on1ミーティングにおける発話比率を測定し、可視化するWebアプリケーションです。上司が話しすぎることを防ぎ、より効果的な1on1を実現することを目的としています。

## 機能仕様

### 1. 初回登録機能

#### 目的
上司の声を事前に登録することで、1on1中に上司と部下の発話を自動的に識別できるようにします。

#### 操作フロー
1. 「初回登録」タブを開く
2. 「声の登録を開始」ボタンをクリック
3. マイクへのアクセス許可を求められたら「許可」をクリック
4. 10秒間、自然な声で話す（音声レベルがリアルタイムで表示される）
5. 自動的に登録が完了し、登録日時が表示される

#### 技術仕様
- **録音時間**: 10秒間（自動停止）
- **データ保存**: LocalStorage（ブラウザローカル）
- **音響特徴量**: 音量（RMS）と周波数特性（低周波数帯域の平均値）
- **サンプリング**: 発話判定閾値（音量30以上）を超えた音声のみを記録

#### 保存データ形式
```json
{
  "data": [
    {
      "volume": 45.2,
      "frequency": 120.5,
      "timestamp": 1730176088753
    }
  ],
  "timestamp": 1730176088753,
  "sampleCount": 150
}
```

### 2. 1on1測定機能

#### 目的
1on1ミーティング中の発話比率をリアルタイムで測定し、終了後に結果を表示します。

#### 操作フロー
1. 「1on1測定」タブを開く
2. 「1on1開始」ボタンをクリック
3. マイクへのアクセス許可を求められたら「許可」をクリック
4. 1on1を実施（リアルタイムで発話時間が表示される）
5. 「1on1終了」ボタンをクリック
6. 結果が円グラフとともに表示される

#### 技術仕様
- **話者識別**: 登録された上司の声紋データとの周波数特性比較
- **発話判定**: 音量閾値（30以上）で発話を検出
- **時間計測**: ミリ秒単位で発話時間を累積
- **リアルタイム表示**: 音声レベルバーと発話時間を動的に更新

#### 測定データ
- 総会話時間
- 上司の発話時間
- 部下の発話時間
- 発話比率（パーセンテージ）

### 3. 結果表示機能

#### 表示内容
1. **統計情報**
   - 総会話時間
   - 上司の発話時間
   - 部下の発話時間

2. **円グラフ**
   - Chart.jsを使用した視覚的な比率表示
   - 上司: 青色
   - 部下: オレンジ色

3. **アドバイス**
   - 上司の発話比率が60%超: 「上司が話しすぎ」の警告
   - 上司の発話比率が30%未満: 「良い傾聴」の評価
   - 30-60%: 「バランスが良い」の評価

## 技術スタック

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: スタイリング
- **Tailwind CSS 3.x**: ユーティリティファーストCSS（CDN）
- **JavaScript ES6**: アプリケーションロジック
- **Chart.js**: 円グラフの描画（CDN）

### Web API
- **Web Audio API**: マイク音声の取得と解析
- **MediaDevices API**: マイクへのアクセス
- **LocalStorage API**: データの永続化

## 音声認識アルゴリズム

### 音量計算（RMS）
```
1. analyser.getByteTimeDomainData()で時間領域のデータを取得
2. 各サンプルを正規化（-1〜1）
3. 二乗平均平方根（RMS）を計算
4. 0-100のスケールに変換
```

### 周波数特性計算
```
1. analyser.getByteFrequencyData()で周波数領域のデータを取得
2. 低周波数帯域（全体の30%）の平均値を計算
3. この値を音響特徴量として使用
```

### 話者識別（Azure Speech Service版）
```
1. 登録時：Azure Speech ServiceのConversationTranscriberがスピーカーIDを付与（例: "Guest-1"）
2. スピーカーIDをLocalStorageに保存
3. 測定時：各発話のスピーカーIDを取得
4. 登録されたスピーカーIDと照合
5. 一致する場合は「上司」、一致しない場合は「部下」と判定
```

**重要な仕様:**
- Azure Speech Serviceのダイアライゼーション機能を使用
- スピーカーIDは同一セッション内でのみ一貫性が保証される
- 登録と測定は同じセッション内（ページを再読み込みしない）で実施する必要がある
- ページを再読み込みした場合、新しいセッションが開始されるため再登録が必要

> **注**: より高精度な話者識別（セッションをまたいだ識別）には、Azure Speaker Recognition APIの使用が推奨されます。ただし、ブラウザJavaScript SDKでは未サポートのため、REST APIの直接呼び出しが必要です。

## データフロー

```
[マイク] → [Web Audio API] → [音響特徴量抽出]
                                     ↓
                            [話者識別アルゴリズム]
                                     ↓
                              [上司 or 部下]
                                     ↓
                            [発話時間の累積]
                                     ↓
                          [LocalStorageに保存]
                                     ↓
                            [結果の可視化]
```

## セキュリティとプライバシー

### データ保存
- **保存場所**: ブラウザのLocalStorage（PCローカル）
- **外部送信**: なし（すべての処理がブラウザ内で完結）
- **音声録音**: 音声ファイル自体は保存されず、音響特徴量のみを保存

### マイクアクセス
- ブラウザの標準的なマイク許可ダイアログを使用
- ユーザーが明示的に許可した場合のみ動作
- 測定終了時にマイクストリームを確実に停止

## ブラウザ互換性

### 対応ブラウザ
- ✅ Google Chrome 90+
- ✅ Mozilla Firefox 88+
- ✅ Microsoft Edge 90+
- ✅ Safari 14+（macOS/iOS）

### 必須機能
- Web Audio API
- MediaDevices.getUserMedia()
- LocalStorage
- ES6 JavaScript
- Canvas（Chart.js用）

## 制限事項

1. **話者識別の制限（重要）**
   - Azure Speech Serviceのダイアライゼーション機能を使用
   - スピーカーIDは同一セッション内でのみ一貫性が保証される
   - **登録と測定は同じセッション内（ページを再読み込みしない）で実施する必要がある**
   - ページを再読み込みやブラウザを閉じると、新しいセッションが開始され再登録が必要
   - 環境ノイズが多い場合や発話が短い場合、話者識別の精度が低下する可能性あり

2. **ブラウザローカル**
   - データはブラウザのLocalStorageに保存されるため、ブラウザを変更したりクリアすると消失
   - 複数のPCで同じ登録データを共有できない

3. **リアルタイム処理**
   - CPUに負荷がかかる可能性あり
   - 低スペックPCでは動作が不安定になる場合あり

## 今後の改善案

1. **話者識別の高精度化**
   - 機械学習モデル（TensorFlow.js）の導入
   - MFCCなどの高度な音響特徴量の使用
   - 複数回の登録によるモデルの改善

2. **データのエクスポート**
   - CSV形式でのエクスポート機能
   - 過去の1on1履歴の保存と分析

3. **複数人対応**
   - 3人以上のミーティングへの対応
   - 各参加者の声の個別登録

4. **クラウド連携**
   - バックエンドとの連携
   - チーム全体での統計分析

## ライセンス

MIT License

## 作成日

2025年10月29日
