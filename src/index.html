<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1on1 発話比率測定アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Azure Speech SDK -->
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <style>
        /* カスタムスタイル */
        .recording-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .voice-bar {
            transition: height 0.1s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- ヘッダー -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-900 mb-2">1on1 発話比率測定アプリ</h1>
            <p class="text-gray-600">上司と部下の発話バランスを可視化</p>
        </header>

        <!-- メインコンテンツ -->
        <div class="bg-white rounded-lg shadow-xl p-6 md:p-8 mb-6">
            <!-- タブナビゲーション -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-settings" class="tab-button px-6 py-3 font-semibold text-indigo-600 border-b-2 border-indigo-600">
                    Azure設定
                </button>
                <button id="tab-registration" class="tab-button px-6 py-3 font-semibold text-gray-500 hover:text-indigo-600">
                    上司の声登録
                </button>
                <button id="tab-meeting" class="tab-button px-6 py-3 font-semibold text-gray-500 hover:text-indigo-600">
                    1on1測定
                </button>
            </div>

            <!-- Azure設定タブ -->
            <div id="content-settings" class="tab-content">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Azure Speech Service 設定</h2>
                    <p class="text-gray-600 mb-6">
                        Azure Speech Serviceを使用して音声認識を行います。<br>
                        Azure ポータルで作成したSpeech Serviceのサブスクリプションキーとリージョンを入力してください。
                    </p>

                    <!-- Azure設定フォーム -->
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                サブスクリプションキー <span class="text-red-500">*</span>
                            </label>
                            <input 
                                type="password" 
                                id="azure-subscription-key" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="例: 1234567890abcdef1234567890abcdef"
                            />
                            <p class="text-xs text-gray-500 mt-1">
                                Azure ポータル &gt; Speech Service &gt; キーとエンドポイント で取得できます
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                リージョン <span class="text-red-500">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="azure-region" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="例: japaneast"
                            />
                            <p class="text-xs text-gray-500 mt-1">
                                一般的なリージョン: japaneast, eastus, westus2, westeurope など
                            </p>
                        </div>
                    </div>

                    <!-- 設定保存ボタン -->
                    <button id="btn-save-settings" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                        設定を保存
                    </button>

                    <!-- 設定状態表示 -->
                    <div id="settings-status" class="mt-4 hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <p class="text-sm text-green-800">✓ Azure設定が保存されています</p>
                        </div>
                    </div>

                    <!-- 注意事項 -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-6">
                        <h3 class="font-semibold text-yellow-800 mb-2">⚠️ 注意事項</h3>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• サブスクリプションキーは安全に管理してください</li>
                            <li>• このアプリケーションは教育・デモ目的で作成されています</li>
                            <li>• ブラウザのLocalStorageに保存されます（平文保存）</li>
                            <li>• 本番環境では適切なセキュリティ対策を実施してください</li>
                        </ul>
                    </div>

                    <!-- Azure Speech Serviceについて -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                        <h3 class="font-semibold text-blue-800 mb-2">📘 Azure Speech Serviceについて</h3>
                        <p class="text-sm text-blue-700 mb-2">
                            Azure Speech Serviceは、Microsoftが提供するAI音声認識サービスです。
                        </p>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>• リアルタイム音声認識</li>
                            <li>• 話者ダイアライゼーション（話者識別）</li>
                            <li>• 高精度な音声認識</li>
                        </ul>
                        <a 
                            href="https://azure.microsoft.com/ja-jp/services/cognitive-services/speech-services/" 
                            target="_blank"
                            class="text-sm text-blue-600 hover:text-blue-800 underline mt-2 inline-block"
                        >
                            詳細はこちら →
                        </a>
                    </div>
                </div>
            </div>

            <!-- 初回登録タブ -->
            <div id="content-registration" class="tab-content hidden">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">上司の声を登録</h2>
                    <p class="text-gray-600 mb-6">
                        ⚠️ <strong>現在のバージョンの制限事項:</strong><br>
                        Azure Speech Serviceのダイアライゼーション機能の技術的制限により、
                        登録された音声を使った話者識別は正確に動作しません。<br>
                        <strong class="text-red-600">1on1測定時は、必ず上司から話し始めることで識別を行います。</strong><br>
                        <br>
                        このタブでの登録は現在、動作確認用途となっています。
                    </p>

                    <!-- Azure未設定の警告 -->
                    <div id="warning-no-azure-settings" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
                        <p class="text-sm text-yellow-800">
                            ⚠️ Azure Speech Serviceの設定がされていません。先に「Azure設定」タブで設定を行ってください。
                        </p>
                    </div>

                    <!-- 音声レベル表示 -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">音声レベル</label>
                        <div class="h-8 bg-gray-200 rounded-full overflow-hidden">
                            <div id="voice-level-register" class="voice-bar h-full bg-gradient-to-r from-green-400 to-green-600" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- 登録ボタン -->
                    <div class="flex gap-4 mb-6">
                        <button id="btn-start-registration" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                            声の登録を開始
                        </button>
                        <button id="btn-stop-registration" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 hidden">
                            登録を停止
                        </button>
                    </div>

                    <!-- 登録状態表示 -->
                    <div id="registration-status" class="bg-gray-100 rounded-lg p-4 mb-4 hidden">
                        <p class="text-sm text-gray-700"></p>
                    </div>

                    <!-- 登録済み情報 -->
                    <div id="registered-info" class="bg-green-50 border border-green-200 rounded-lg p-4 hidden">
                        <h3 class="font-semibold text-green-800 mb-2">✓ 上司の声が登録されています</h3>
                        <p class="text-sm text-green-700">登録日時: <span id="registration-date"></span></p>
                        <button id="btn-clear-registration" class="mt-3 text-sm text-red-600 hover:text-red-800 underline">
                            登録をクリア
                        </button>
                    </div>
                </div>
            </div>

            <!-- 1on1測定タブ -->
            <div id="content-meeting" class="tab-content hidden">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">1on1 測定</h2>
                    
                    <!-- 測定前の案内 -->
                    <div id="meeting-info" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-blue-800 mb-2">📋 測定開始前の重要な注意</h3>
                        <p class="text-sm text-blue-800 mb-2">
                            「1on1開始」ボタンを押した後、<strong class="text-red-600">必ず上司から話し始めてください</strong>。<br>
                        </p>
                        <p class="text-sm text-blue-700">
                            会話が終わったら「1on1終了」ボタンを押してください。
                        </p>
                        <div class="mt-3 bg-yellow-50 border border-yellow-200 rounded px-3 py-2">
                            <p class="text-xs text-yellow-800">
                                ⚠️ 技術的制限: Azureのダイアライゼーション機能は発話順序でIDを割り当てるため、
                                部下が先に話すと役割が逆転して記録されます。
                            </p>
                        </div>
                    </div>

                    <!-- 未登録警告は削除（登録不要なため） -->

                    <!-- 測定コントロール -->
                    <div class="flex gap-4 mb-6">
                        <button id="btn-start-meeting" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 rounded-lg transition duration-200 text-lg">
                            📊 1on1開始
                        </button>
                        <button id="btn-stop-meeting" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg transition duration-200 text-lg hidden">
                            ⏹️ 1on1終了
                        </button>
                    </div>

                    <!-- 測定中表示 -->
                    <div id="meeting-active" class="hidden">
                        <!-- 録音中インジケーター -->
                        <div class="bg-red-50 border border-red-300 rounded-lg p-4 mb-6 flex items-center">
                            <span class="recording-indicator inline-block w-3 h-3 bg-red-500 rounded-full mr-3"></span>
                            <span class="text-red-700 font-semibold">測定中...</span>
                            <span id="meeting-timer" class="ml-auto text-gray-700 font-mono text-lg">00:00</span>
                        </div>

                        <!-- リアルタイム音声レベル -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">上司の発話</label>
                                <div class="h-6 bg-gray-200 rounded-full overflow-hidden">
                                    <div id="voice-level-manager" class="voice-bar h-full bg-gradient-to-r from-blue-400 to-blue-600" style="width: 0%"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">部下の発話</label>
                                <div class="h-6 bg-gray-200 rounded-full overflow-hidden">
                                    <div id="voice-level-member" class="voice-bar h-full bg-gradient-to-r from-orange-400 to-orange-600" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- リアルタイム発話時間 -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-blue-50 rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">上司の発話時間</p>
                                <p id="time-manager" class="text-2xl font-bold text-blue-600">0秒</p>
                            </div>
                            <div class="bg-orange-50 rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">部下の発話時間</p>
                                <p id="time-member" class="text-2xl font-bold text-orange-600">0秒</p>
                            </div>
                        </div>
                    </div>

                    <!-- 結果表示 -->
                    <div id="meeting-result" class="hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">測定結果</h3>
                        
                        <!-- 統計情報 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-gray-50 rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">総会話時間</p>
                                <p id="result-total-time" class="text-xl font-bold text-gray-800">0秒</p>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">上司の発話時間</p>
                                <p id="result-manager-time" class="text-xl font-bold text-blue-600">0秒</p>
                            </div>
                            <div class="bg-orange-50 rounded-lg p-4 text-center">
                                <p class="text-sm text-gray-600 mb-1">部下の発話時間</p>
                                <p id="result-member-time" class="text-xl font-bold text-orange-600">0秒</p>
                            </div>
                        </div>

                        <!-- 円グラフ -->
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 text-center">発話比率</h4>
                            <div class="max-w-md mx-auto">
                                <canvas id="result-chart"></canvas>
                            </div>
                        </div>

                        <!-- アドバイス -->
                        <div id="result-advice" class="rounded-lg p-4 mb-4">
                            <!-- JavaScriptで動的に生成 -->
                        </div>

                        <!-- 新規測定ボタン -->
                        <button id="btn-new-meeting" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                            新しい1on1を測定
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- フッター -->
        <footer class="text-center text-gray-600 text-sm">
            <p>© 2025 1on1 発話比率測定アプリ - より良い1on1のために</p>
        </footer>
    </div>

    <!-- メインスクリプト -->
    <script src="js/script.js"></script>
</body>
</html>
